# CCTV_Streaming

RTSP ?? ??? HLS? ??? ? ?????? ???? CCTV ???? ???????.

?? ??? WebRTC ?? ?? ??? ?????.

```text
RTSP ?? -> ffmpeg(HLS ??) -> Spring Boot(/hls ?? ??) -> React(hls.js)
```

## ???? ??

- `apps/back-end`: Spring Boot ?? (`/health`, `/hls/**`)
- `apps/front-end`: React + Vite HLS ????
- `apps/cctv/device`: ESP32-CAM(MJPEG HTTP ??) + PC RTSP ??? ????
- `scripts/rtsp_to_hls.sh`: RTSP -> HLS ??
- `scripts/publish_rtsp.sh`: ?? ?? -> RTSP ??

## ????

- Linux (Ubuntu ?)
- Java 17+
- Node.js 18+
- ffmpeg (PATH ??)

## ?? ?? (Linux)

???? ???? ?????.

1) ??? ??

```bash
cd apps/back-end
./gradlew bootRun
```

2) ???? RTSP ?? (docs/video.mp4 ?? ??)

```bash
cd ../..
./scripts/publish_rtsp.sh
```

3) RTSP? HLS? ??

```bash
./scripts/rtsp_to_hls.sh
```

4) ??? ??

```bash
npm --prefix apps/front-end install
npm --prefix apps/front-end run dev
```

5) ??

- ????: `http://localhost:5173`
- HLS ?????: `http://localhost:8080/hls/mystream.m3u8`
- ????: `http://localhost:8080/health`

## ??? ??(PC) ??

### Python ????

`apps/cctv/device/pc_rtsp_publisher.py`? `docs/video.mp4`? ?? ??? RTSP? ?????.

```bash
python apps/cctv/device/pc_rtsp_publisher.py --rtsp-url rtsp://localhost:8554/mystream
```

??:
- `--video`: ?? ?? ?? ?? (??: `docs/video.mp4`)
- `--rtsp-url`: ?? RTSP URL
- `--transport`: `tcp` ?? `udp` (?? `tcp`)
- `--transcode`: ?? H.264/AAC ???

### Bash ????

- `scripts/publish_rtsp.sh`
  - `VIDEO_FILE`, `RTSP_URL`, `RTSP_TRANSPORT`, `TRANSCODE`

- `scripts/rtsp_to_hls.sh`
  - `RTSP_URL`, `STREAM_ID`, `HLS_DIR`, `HLS_TIME`, `HLS_LIST_SIZE`, `HLS_DELETE`, `RTSP_TRANSPORT`, `TRANSCODE`

## ?? ???

### ??? (`apps/back-end/src/main/resources/application.properties`)

- `hls.path`: `/hls/**`? ??? ?? ????
- `hls.allowed-origins`: HLS ??? CORS ?? Origin

???:

- `hls.path=./hls`
- `hls.allowed-origins=http://localhost:5173`

### ???

- `VITE_HLS_BASE_URL`: ?? HLS ??? URL
- `VITE_HLS_URL`: ?? ????? URL ?? ??
- `VITE_STREAM_ID`: ?? Stream ID

## ESP32-CAM ?? ??

`apps/cctv/device/main.cpp` ???? RTSP? ??? MJPEG HTTP? ?????.

- ?? ???: `http://<device-ip>/`
- MJPEG ???: `http://<device-ip>:81/stream`

RTSP ?????? ???? MJPEG -> RTSP ???? ??? ?????.

??:

```bash
ffmpeg -f mjpeg -i http://<device-ip>:81/stream -c:v libx264 -f rtsp rtsp://<rtsp-server>:8554/mystream
```

? ?? `scripts/rtsp_to_hls.sh`? ???? ???.

## ?????

- `ffmpeg command not found in PATH`
  - ffmpeg ?? ? PATH ?? ??

- ?????? HLS ?? ??
  - `http://localhost:8080/hls/<streamId>.m3u8` ?? ???? ??
  - `hls.allowed-origins`? ??? ?? ?? ?? ??
